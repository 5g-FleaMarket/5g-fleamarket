<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>Document</title>
</head>

<style>
  .col-md-3{
    height: 80px;  
    text-align: center; 
    line-height: 40px;
  }

  .col-md-3 > input {
    width: 70%; 
    height: 50%; 
    margin-top: 30px;
    border: 1px solid #0597F2;
    background-color: white;
    border-radius: 6px;
  }

  .col-md-3 > input[type="button"]:hover{
  border-radius: 6px;
  border: 2px solid #0597F2;

   
    }

  #logout-btn{
    margin-left: 25%;
    margin-top: 4%;
    align-content: center;
    background-color: #F2F2F2;
    border-radius: 6px;
    border: 1px #F2F2F2;
  }

  #logout-btn:hover{
    background-color: #f2f2f2d6;
    border: 1px black;
    box-shadow: 0 10px 12px -3px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

</style>
<body>
    
    <!--상단 메뉴바-->
<div class="container-fluid" style="height: 40px; position: fixed; top:0; background: #fff; height: 40px;">
    <div class="container">
      <div class="row">
        <div class="col-md-2"
        style="background: #0597F2; height: 50px;
       display: flex;
       align-items: center;
       justify-content: center;
       padding: 0">
       <img src="https://velog.velcdn.com/images/ms_sh0728/post/d04aed63-939c-41d1-aaca-d220bb0b70f8/image.png"
            alt="spcFuck" style="width: 100%; height: 100%; margin: 0" />

   </div>
        <div class="col-md-8" style="background: #0597F2; height: 50px; display: flex;">
          <input id="search" type="text" placeholder="검색어를 입력해주세요!" style="flex: 1 1 auto; height: 100%; border: 0; padding: 0; border-radius: 10px;"
                 onkeypress="handleKeyPress(event)">
          <button onclick="search()" style="width: 40px; height: 100%; background: #0597F2; border: 1px;">🔍</button>
        </div>
        <div class="col-md-2" style="background: #0597F2; height: 50px;"><input id="logout-btn"  type="button" onclick="logout()" value="로그아웃🚪"></div>
      </div>
    </div>
  </div>
  <!--본 내용-->
  <div class="container-fluid" style="background:#eee; margin-top: 40px; margin-bottom: 40px;">
    <div class="container" style="background: #fff;padding: 0">
      <div id="headerMenu" style="padding: 0">
        <div class="row">
          <div class="col-md-3">
            <input type="button" id="product-btn" class="submit-btn" onclick="checkLogin('product')" value="상품">
          </div>
          <div class="col-md-3">
            <input type="button" id="user-btn" class="submit-btn" onclick="checkLogin('user')" value="회원">
          </div>
          <div class="col-md-3" >
            <input type="button" id="category-btn" class="submit-btn" onclick="checkLogin('category')" value="카테고리">
          </div>
          <div class="col-md-3">
            <input type="button" id="notice-btn" class="submit-btn" onclick="checkLogin('notice')" value="공지사항">
          </div>
        </div>
      </div>
    </div>
  </div>
   
    
</body>

<script>
  
function logout() {
    axios
        .post('http://localhost:3000/admin/logout'
        )
        .then((res) => {
            // 응답처리
            alert(res.data)
            window.location.href = '/admin/login'
        })
        .catch((error) => {
            // 예외처리
            alert(error.response?.data?.message || error.response.data.errorMessage.details[0].message);
        });
}



function checkLogin(service) {

    if(service === "product") {
        axios
            .get('http://localhost:3000/products')
            .then((res) => {
              window.location.href = '/products'
                })
            .catch((error) => {
                // 예외처리 - 로그인안하고 들어올때 or 로그인 쿠키가 없을 때
                console.log(error)
                if (error.response.status === 401) {
                    alert('로그인하셔야 합니다.');
                    window.location.href = '/admin/login'
                }})
              }
    else if (service === 'user'){
      axios
            .get('http://localhost:3000/users')
            .then((res) => {
              window.location.replace('http://localhost:3000/users')
                })
            .catch((error) => {
                // 예외처리 - 로그인안하고 들어올때 or 로그인 쿠키가 없을 때
                console.log(error)
                if (error.response.status === 401) {
                    alert('로그인하셔야 합니다.');
                    window.location.href = '/admin/login'
                }})
    }
    else if(service === "category"){
      axios
            .get('http://localhost:3000/category')
            .then((res) => {
              window.location.href = '/category'
                })
            .catch((error) => {
                // 예외처리 - 로그인안하고 들어올때 or 로그인 쿠키가 없을 때
                console.log(error)
                if (error.response.status === 401) {
                    alert('로그인하셔야 합니다.');
                    window.location.href = '/admin/login'
                }})
    }
    else if(service === "notice"){
      axios
            .get('http://localhost:3000/notice')
            .then((res) => {
              window.location.href = '/notice'
                })
            .catch((error) => {
                // 예외처리 - 로그인안하고 들어올때 or 로그인 쿠키가 없을 때
                if (error.response.status === 401) {
                    alert('로그인하셔야 합니다.');
                    window.location.href = '/admin/login'
                }})
    }
              }





              function handleKeyPress(e) {
  if (e.keyCode === 13) {
    // 엔터 키를 누르면 검색 함수 호출
    search();
  }
}


function search() {
  const search = document.getElementById('search').value;
  console.log(search);

  if (window.location.href === 'http://localhost:3000/products'){
    axios
    .get(`http://localhost:3000/productSearch?search=${search}`)
    .then((res) => {
      let data = res.data.data;
      let temp = '';
      for (let i = 0; i < data.length; i++) {

        document.getElementById(`bb`).innerHTML = "";

        const timeAgo = getTimeAgo(data[i].createdAt);

        // 검색어 배경색 적용
        const title = data[i].title.replace(
          new RegExp(`(${search})`, 'gi'),
          '<span style="background-color: yellow">$1</span>',
        );
        

        temp += `

        <div class="container-fluid" style=" margin-top: 20px;" onclick="getProduct(${data[i].id})" id="bb">
                <div class="row" style="cursor: pointer; ">
                  <div class="col-md-3" style="margin-left: 13%;" id="image-container">
                    <img src="https://news.koreadaily.com/data/photo/2023/03/10/202303040941779270_6404a4b927e18.jpg" alt="spcFuck" id="image"/>
                  </div>
                  <div class="col-md-8" id="products-column" >
                      <h3 > ${title}</h3>
                      <h3>${data[i].price} 원</h3>
                      <br>
                      <span style="float: right;">❤ ${data[i].likes}</span>
                      <span style="float: right;">🎯${data[i].dealCount}  &nbsp </span>
                      <span style="float: right;">👀:${data[i].viewCount}회 &nbsp</span>
                      
                    </div>
                </div>
              </div>`;
      }
      document.getElementById('bb').innerHTML = temp;
    })
    .catch((error) => {
      alert(error.response.data.message);
      window.location.reload();
    });
  }
  else if (window.location.href === 'http://localhost:3000/users'){
    axios
    .get(`http://localhost:3000/userSearch?search=${search}`)
    .then((res) => {
      let data = res.data.data;
      let temp = '';
      for (let i = 0; i < data.length; i++) {

        document.getElementById(`bb`).innerHTML = "";

        // 검색어 배경색 적용
        const nickname = data[i].nickname.replace(
          new RegExp(`(${search})`, 'gi'),
          '<span style="background-color: yellow">$1</span>',
        );

        if (data[i].ban === 1) {

           temp += `<div class="container-fluid" style=" margin-top: 20px;" onclick="getUser(${data[i].id})">
                <div class="row">
                  <div class="col-md-8" style="padding: 10px; margin-left: 17%; border: 3px dotted #5cd7f2; border-radius: 3px; cursor: pointer;">
                    
                      <h4>닉네임: </h4>
                      <h3 style="margin-left: 30px;"> ${nickname}</h3>
                      <br>
                      <h4>이메일: </h4>
                      <h3 style="margin-left: 30px;">${data[i].email} </h3 >
                      <br>
                      <h4>전화번호: </h4>
                      <h3 style="margin-left: 7px;">  ${data[i].phone}</h3>
                      <span style="float: right;margin-top:45px"> 😡블랙리스트 </span>
                    </div>
                   
                </div>
              </div>`
        }

        else{
          temp += `<div class="container-fluid" style=" margin-top: 20px;" onclick="getUser(${data[i].id})">
                <div class="row">
                  <div class="col-md-8" style="padding: 10px; margin-left: 17%; border: 3px dotted #5cd7f2; border-radius: 3px; cursor: pointer;">
                    
                      <h4>닉네임: </h4>
                      <h3 style="margin-left: 30px;"> ${nickname}</h3>
                      <br>
                      <h4>이메일: </h4>
                      <h3 style="margin-left: 30px;">${data[i].email} </h3 >
                      <br>
                      <h4>전화번호: </h4>
                      <h3 style="margin-left: 7px;">  ${data[i].phone}</h3>
                    </div>
                   
                </div>
              </div>`
        }

       ;
      }
      document.getElementById('bb').innerHTML = temp;
    })
    .catch((error) => {
      alert(error.response.data.message);
      window.location.reload();
    });
}

else if (window.location.href === 'http://localhost:3000/category'){

  axios
    .get(`http://localhost:3000/categorySearch?search=${search}`)
    .then((res) => {
      let data = res.data.data;
      let temp = '';
      for (let i = 0; i < data.length; i++) {

        document.getElementById(`bb`).innerHTML = "";

        // 검색어 배경색 적용
        const name = data[i].name.replace(
          new RegExp(`(${search})`, 'gi'),
          '<span style="background-color: yellow">$1</span>',
        );

        temp += `<div class="container-fluid" style=" margin-top: 20px;" >
                <div class="row" id="categoryList${data[i].id}">
                  <div class="col-md-2" id="image-container"></div>  
                  <div class="col-md-8" style="padding-bottom: 10px; padding-top: 15px;border: 3px dotted #5cd7f2; border-radius: 3px; cursor: pointer;">
                      <h4>카테고리:</h4>
                      <h3 id="cat-name"> ${name}</h3>
                      <br>
                      <br>
                      <button class="category-btn" id="updateCategory-btn" onclick="updateCategory(${data[i].id}, '${data[i].name}')"> 수정 </button>
                    <button class="category-btn" style="float: right;" onclick="deleteCategory(${data[i].id})">삭제</button>
                    </div>
                </div>
              </div>`;
      }
      document.getElementById('bb').innerHTML = temp;
    })
    .catch((error) => {
      alert(error.response.data.message);
      window.location.reload();
    });

}

else if (window.location.href === 'http://localhost:3000/notice'){

  axios
    .get(`http://localhost:3000/noticeSearch?search=${search}`)
    .then((res) => {
      let data = res.data.data;
      let temp = '';
      for (let i = 0; i < data.length; i++) {

        document.getElementById(`bb`).innerHTML = "";

        // 검색어 배경색 적용
        const title = data[i].title.replace(
          new RegExp(`(${search})`, 'gi'),
          '<span style="background-color: yellow">$1</span>',
        );

        temp += ` <div class="container-fluid" style=" margin-top: 20px;" onclick="getNotice(${data[i].id})">
                <div class="row">
                  <div class="col-md-2" id="image-container"></div> 
                    <div class="col-md-8" style="border: 3px dotted #5cd7f2; border-radius: 3px; cursor: pointer;">
                      <h3>${title}</h3>
                      <br>
                    </div>
                </div>
              </div>`;
      }
      document.getElementById('bb').innerHTML = temp;
    })
    .catch((error) => {
      alert(error.response.data.message);
      window.location.reload();
    });

}


}


// Date 객체를 사용하여 일정 기간 전인지 계산하는 함수
function getTimeAgo(dateString) {
  const now = new Date();
  const date = new Date(dateString);
  const diff = now - date;
  const minutes = Math.floor(diff / 60000);
  const hours = Math.floor(diff / 3600000);
  const days = Math.floor(diff / 86400000);
  const weeks = Math.floor(diff / 604800000);
  const months = Math.floor(diff / 2592000000);
  const years = Math.floor(diff / 31536000000);

  switch (true) {
    case minutes < 5:
      return `방금 전`;
    case hours < 1:
      return `${minutes}분 전`;
    case days < 1:
      return `${hours}시간 전`;
    case weeks < 1:
      return `${days}일 전`;
    case months < 1:
      return `${weeks}주 전`;
    case years < 1:
      return `${months}달 전`;
    default:
      return `${years}년 전`;
  }
}

</script>
</html>