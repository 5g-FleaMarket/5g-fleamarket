<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>카테고리</title>

  <!--    BootStrap Library-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link
      href="https://fonts.googleapis.com/css2?family=Dongle:wght@700&family=Jua&family=Noto+Serif+KR:wght@200&display=Gowun+Dodum&display=swap"
      rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
          crossorigin="anonymous"></script>
  <!--    JQuery-->
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <!--    &lt;!&ndash;    JQuery Cookie&ndash;&gt;-->
  <!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>-->

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>
<style>

</style>
<script>

</script>
<body>

  <%- include('admin-header.ejs')%>

<div class="container-fluid" style="background:#eee; margin-top: 40px; margin-bottom: 40px;">
  <div class="container" style="background: #fff; margin-top: 20px;padding: 0;">
    
    <% if (typeof errorMessage !== 'undefined') { %>
            <%= errorMessage %>
          <% } else if (category) { %>


            <% for (var i = 0; i < category.length; i++) { %>
              <div class="container-fluid" style="border: 1px solid red; margin-top: 20px;" >
                <div class="row" id="categoryList">
                    <div class="col-md-9">
                      <h3>name: <%= category[i].name %></h3>
                      <p>//</p>
                      <h4> //</h4>
                      <span>//</span>
                      <button onclick="updateCategory(`<%=category[i].id %>`, `<%= category[i].name %>`)">수정</button>
                    <button style="float: right;" onclick="deleteCategory(`<%=category[i].id %>`)">삭제</button>
                    </div>
                </div>
              </div>
            <% } %>

            
          <% } %>
  </div>
</div>

<!--하단 메뉴바-->

<%- include('admin-footer.ejs')%>

</body>

<script>

    function updateCategory (categoryId, name) {
        
        document.getElementById("categoryList").innerHTML = "";
        let temp_html = `
        <div class="col-md-9">
                      <h3>
                      name:
                    <input type="text" id="name" value= "${name}">
                    </h3>  
                    <button style="float: left;"onclick ="completeUpdate(${categoryId})">수정완료</button> 
                    <button style="float: right;" onclick ="cancleUpdate()">취소</button>
                    </div>
        `
        document.getElementById("categoryList").innerHTML = temp_html;
    }

    function cancleUpdate(){
        window.location.reload()
    }
    function completeUpdate(categoryId){
        const name =  document.getElementById('name').value;
        axios
        .put(`http://localhost:3000/category/${categoryId}`,
            { name: name}
        )
        .then((res) => {
            // 응답처리
            alert(JSON.stringify(res.data))
            window.location.replace("http://localhost:3000/category")
        })
        .catch((error) => {
            // 예외처리
            alert(error.response?.data?.message || error.response.data.errorMessage.details[0].message);
        });
    }

    function createCategory(){
        window.location.replace("http://localhost:3000/post/category")
    }

    function deleteCategory(categoryId){
        if(confirm('정말 삭제하시겠습니까?')){ 
        axios
        .delete(`/category/${categoryId}`)
        .then((res) => {
            // 응답처리
            alert(JSON.stringify(res.data.message))
            window.location.replace("http://localhost:3000/category")
        })
        .catch((error) => {
            // 예외처리
            alert(error.response?.data?.message || error.response.data.errorMessage.details[0].message);
        });
    }    
    }



</script>

</html>